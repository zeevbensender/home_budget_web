# =========================================
# Home Budget Web â€” Backend Makefile
# Milestone 1: FastAPI + PostgreSQL backend
# =========================================

# Variables
COMPOSE = docker compose
SERVICE = backend

# ------------------------------
# ğŸ§± Build the backend container
# ------------------------------
build:
	$(COMPOSE) build

# ------------------------------
# ğŸš€ Start the stack (backend + db)
# ------------------------------
up:
	$(COMPOSE) up

# ------------------------------
# ğŸš€ Start in detached mode
# ------------------------------
up-detached:
	$(COMPOSE) up -d

# ------------------------------
# ğŸ§© Stop and remove containers
# ------------------------------
down:
	$(COMPOSE) down

# ------------------------------
# ğŸ§¹ Stop and remove containers + volumes
# ------------------------------
clean:
	$(COMPOSE) down -v

# ------------------------------
# ğŸ§ª Run tests inside the backend container
# ------------------------------
test:
	$(COMPOSE) run --rm $(SERVICE) poetry run pytest -v

# ------------------------------
# ğŸ” Rebuild from scratch (no cache)
# ------------------------------
rebuild:
	$(COMPOSE) build --no-cache